# Pool Visualizer 95% Production Ready Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Bring the pool visualizer from 85% to 95% production ready with 4 key features.

**Architecture:** Three of four features are frontend-only. One requires backend PIL watermarking on generated images. All changes are additive and non-breaking.

**Tech Stack:** Django REST Framework, React 19, PIL/Pillow, Lucide React icons

---

## Status Summary

| Feature | Status | Notes |
|---------|--------|-------|
| Regenerate Button | COMPLETE | Already exists at `ResultDetailPage.js:265-267` |
| User Guidance | PENDING | Add backyard-specific hints to upload flow |
| AI Disclaimer | COMPLETE | Text disclaimer at `ResultDetailPage.js:222-227` |
| Mobile Testing | PENDING | Test wizard flow, fix responsive issues |

---

## Task 1: User Guidance for Backyard Photos

**Files:**
- Modify: `frontend/src/components/UploadWizard/Step4Upload.js`
- Modify: `frontend/src/components/Upload/ImageUploader.js`
- Modify: `frontend/src/components/Upload/ImageUploader.css`

### Step 1.1: Add guidance text to Step4Upload

Edit `frontend/src/components/UploadWizard/Step4Upload.js` to add backyard-specific guidance:

```javascript
import React, { useCallback } from 'react';
import { ArrowLeft, ArrowRight, Camera, Sun, TreeDeciduous } from 'lucide-react';
import ImageUploader from '../Upload/ImageUploader';

const Step4Upload = ({ formData, setFormData, nextStep, prevStep }) => {
    const handleImageSelect = useCallback((file) => {
        setFormData(prev => ({ ...prev, image: file }));
    }, [setFormData]);

    return (
        <div className="wizard-step fade-in">
            <div className="step-header">
                <h2>Upload Your Backyard Photo</h2>
                <p className="step-subtitle">We'll visualize your new pool in this space</p>
            </div>

            {/* Photo Tips */}
            <div className="photo-tips">
                <h4>For Best Results:</h4>
                <ul className="tips-list">
                    <li><Sun size={16} /> Take photo during daylight hours</li>
                    <li><Camera size={16} /> Stand back to capture the full yard</li>
                    <li><TreeDeciduous size={16} /> Include the area where the pool will go</li>
                </ul>
            </div>

            <div className="upload-container">
                <ImageUploader
                    onImageSelect={handleImageSelect}
                    value={formData.image}
                    placeholderText="Upload a photo of your backyard"
                    hintText="Best: Wide shot showing full yard, taken in daylight"
                />
            </div>

            <div className="wizard-actions">
                <button className="btn-back" onClick={prevStep}>
                    <ArrowLeft size={18} /> Back
                </button>
                <button
                    className="btn-next"
                    onClick={nextStep}
                    disabled={!formData.image}
                >
                    Review <ArrowRight size={18} />
                </button>
            </div>
        </div>
    );
};

export default Step4Upload;
```

**Run:** Manual verification in browser at http://localhost:3000

### Step 1.2: Add placeholder/hint props to ImageUploader

Edit `frontend/src/components/Upload/ImageUploader.js` to accept new props:

Find the prop definitions (around line 6-13) and add:
```javascript
const ImageUploader = ({
  onImageSelect,
  maxSize = 10 * 1024 * 1024,
  acceptedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/webp'],
  disabled = false,
  className = '',
  value,
  placeholderText = 'Drag and drop an image here',  // NEW
  hintText = null  // NEW
}) => {
```

Find the upload placeholder section (around line 191-211) and update:
```javascript
<div className="upload-placeholder">
  <div className="upload-icon">üìÅ</div>
  <div className="upload-text">
    <p className="upload-primary-text">
      {isDragOver ? 'Drop image here' : placeholderText}
    </p>
    <p className="upload-secondary-text">or</p>
    <Button
      variant="outline"
      size="medium"
      disabled={disabled}
      onClick={handleBrowseClick}
    >
      Browse Files
    </Button>
  </div>
  {hintText && (
    <div className="upload-hint">
      <p>{hintText}</p>
    </div>
  )}
  <div className="upload-constraints">
    <p>Max size: {formatFileSize(maxSize)}</p>
    <p>Supported: {acceptedTypes.map(type => type.split('/')[1].toUpperCase()).join(', ')}</p>
  </div>
</div>
```

Update PropTypes (around line 248-254):
```javascript
ImageUploader.propTypes = {
  onImageSelect: PropTypes.func.isRequired,
  maxSize: PropTypes.number,
  acceptedTypes: PropTypes.arrayOf(PropTypes.string),
  disabled: PropTypes.bool,
  className: PropTypes.string,
  placeholderText: PropTypes.string,  // NEW
  hintText: PropTypes.string  // NEW
};
```

### Step 1.3: Add CSS for photo tips and hint

Add to `frontend/src/components/Upload/ImageUploader.css`:

```css
/* Photo Tips for Upload */
.photo-tips {
  background-color: #f0f9ff;
  border: 1px solid #bae6fd;
  border-radius: 8px;
  padding: 1rem;
  margin-bottom: 1.5rem;
}

.photo-tips h4 {
  margin: 0 0 0.75rem 0;
  font-size: 0.9rem;
  color: #0369a1;
  font-weight: 600;
}

.tips-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.tips-list li {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.85rem;
  color: #0c4a6e;
}

.tips-list li svg {
  color: #0ea5e9;
  flex-shrink: 0;
}

/* Upload Hint */
.upload-hint {
  margin-top: 0.75rem;
  padding: 0.5rem 1rem;
  background-color: #fef3c7;
  border-radius: 4px;
}

.upload-hint p {
  margin: 0;
  font-size: 0.8rem;
  color: #92400e;
  font-weight: 500;
}

/* Mobile adjustments */
@media (max-width: 640px) {
  .photo-tips {
    padding: 0.75rem;
  }

  .tips-list {
    gap: 0.375rem;
  }

  .tips-list li {
    font-size: 0.8rem;
  }
}
```

### Step 1.4: Verify changes

**Run:** `cd /home/astre/command-center/testhome/testhome-visualizer/frontend && npm start`

**Verify:**
1. Navigate to upload wizard step 4
2. See "Photo Tips" box with three tips
3. See updated placeholder text in upload area
4. See hint text below "Browse Files" button

### Step 1.5: Commit

```bash
git add frontend/src/components/UploadWizard/Step4Upload.js \
        frontend/src/components/Upload/ImageUploader.js \
        frontend/src/components/Upload/ImageUploader.css
git commit -m "feat: add user guidance for backyard photo uploads

- Add Photo Tips section with daylight/angle/framing hints
- Add customizable placeholder and hint text to ImageUploader
- Add CSS styling for tips and hints
- Improve upload UX for pool visualization workflow"
```

---

## Task 2: Mobile Testing & Optimization

**Files:**
- Test: All wizard components in `frontend/src/components/UploadWizard/`
- Modify: `frontend/src/components/UploadWizard/*.js` (as needed)
- Modify: Various CSS files (as needed)
- Modify: `frontend/src/pages/ResultDetailPage.css`

### Step 2.1: Create mobile testing checklist

Test on these viewport sizes:
- iPhone SE (375x667)
- iPhone 12/13 (390x844)
- iPad (768x1024)
- Android phone (360x800)

### Step 2.2: Test wizard flow steps

For each step, verify:
1. **Step1Categories** - Cards should stack vertically on mobile
2. **Step2Scope** - Form inputs should be full-width
3. **Step4Upload** - Upload area should be tappable, photo tips visible
4. **Step5Review** - Summary should be readable, buttons accessible

Use browser DevTools to simulate mobile viewports.

### Step 2.3: Common mobile fixes (apply as needed)

**Fix touch targets (buttons too small):**
```css
@media (max-width: 640px) {
  .btn, button {
    min-height: 44px;  /* iOS accessibility minimum */
    padding: 12px 16px;
  }
}
```

**Fix horizontal overflow:**
```css
@media (max-width: 640px) {
  .wizard-step {
    padding: 1rem;
    overflow-x: hidden;
  }

  .step-header h2 {
    font-size: 1.25rem;
    word-wrap: break-word;
  }
}
```

**Fix action buttons stacking:**
```css
@media (max-width: 480px) {
  .wizard-actions {
    flex-direction: column;
    gap: 0.75rem;
  }

  .wizard-actions button {
    width: 100%;
  }
}
```

### Step 2.4: Test result detail page on mobile

Navigate to `/results/:id` on mobile and verify:
1. Image comparison works with touch
2. Toggle button is large enough to tap
3. Action bar buttons don't overflow
4. Security report CTA is readable

### Step 2.5: Fix ResultDetailPage mobile issues

Add/update in `frontend/src/pages/ResultDetailPage.css`:

```css
/* Enhanced mobile styles */
@media (max-width: 480px) {
  .result-detail-page {
    padding: 1rem;
  }

  .result-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .result-header h2 {
    font-size: 1.25rem;
  }

  .action-bar {
    flex-direction: column;
  }

  .action-bar .btn {
    width: 100%;
    text-align: center;
    justify-content: center;
  }

  .btn-toggle-view {
    min-width: 160px;
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
  }
}
```

### Step 2.6: Test ProcessingScreen on mobile

Verify:
1. Progress bar is visible
2. Status message is readable
3. Cancel/retry buttons work

### Step 2.7: Document findings and fixes

Create `docs/mobile-testing-notes.md` with findings:

```markdown
# Mobile Testing Notes - 2025-12-24

## Viewport Sizes Tested
- iPhone SE (375x667)
- iPhone 12/13 (390x844)
- iPad (768x1024)
- Android (360x800)

## Issues Found & Fixed
1. [List issues found and fixes applied]

## Known Limitations
1. [Any issues that couldn't be fixed]

## Recommended Future Work
1. [Any optimizations deferred]
```

### Step 2.8: Commit mobile fixes

```bash
git add frontend/src/components/UploadWizard/*.js \
        frontend/src/pages/ResultDetailPage.css \
        docs/mobile-testing-notes.md
git commit -m "fix: improve mobile responsiveness for wizard flow

- Fix touch targets for buttons (min 44px)
- Stack action buttons vertically on small screens
- Adjust typography sizes for mobile
- Document mobile testing findings"
```

---

## Task 3: Regenerate Button (ALREADY COMPLETE)

**Status:** No work needed - feature already exists.

**Evidence:**
- Backend: `api/views.py:180-198` has `regenerate` action
- Frontend API: `frontend/src/services/api.js:337-342` has `regenerateVisualizationRequest`
- Frontend UI: `frontend/src/pages/ResultDetailPage.js:265-267` has regenerate button

The regenerate button:
- Appears in action bar when visualization is complete
- Calls `handleRegenerate` which triggers `regenerateVisualizationRequest(id)`
- Backend resets status to 'pending' and re-triggers AI processing
- Polling picks up status changes automatically

---

## Verification Checklist

Before marking as 95% production ready:

- [ ] User guidance tips appear on upload step
- [ ] Placeholder text is backyard-specific
- [ ] AI disclaimer text shows below result image (already exists)
- [ ] Mobile wizard flow works on iPhone SE viewport
- [ ] Mobile result page works on iPhone SE viewport
- [ ] Touch targets are at least 44px
- [ ] Action buttons stack on mobile
- [ ] Regenerate button works (already verified)

---

## Execution

**Estimated scope:** 2 pending tasks with ~13 steps total (2 features already complete)

**Recommended approach:** Subagent-driven development in this session
- Fresh subagent per task with code review between tasks
- Fast iteration with quality gates
